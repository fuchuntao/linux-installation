<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.meiot.dao.RoleMapper">
	
	<insert id="insertRoleDtoBuilding" >
		INSERT INTO role_building (
			id,
			role_id,
			project_id,
			building_id,
			type
		)
		VALUES
		<foreach collection="listBuilding" item="item" index="index"  separator="," >
			(NULL, #{roleId}, #{projectId}, #{item},0)
		</foreach>
		
	</insert>
	<insert id="insertRoleDtoSelection">
		INSERT INTO role_building (
			id,
			role_id,
			project_id,
			building_id,
			type
		)
		VALUES
		<foreach collection="listSelection" item="item" index="index"  separator="," >
			(NULL, #{roleId}, #{projectId}, #{item},1)
		</foreach>
	</insert>
	
	<select id="load" resultType="Long">
		SELECT
			role_building.building_id
		FROM
			role_building
		WHERE
			role_id = #{roleId}
		AND
			project_id = #{projectId}
		AND
			type = #{type}
	</select>
	
	<select id="queryBuilding" resultType="Long">
		SELECT
			role_building.building_id
		FROM
			role_building
		WHERE
			project_id = #{projectId}
		<if test="listRole != null and listRole.size()>0">
		AND
			role_id in 
		<foreach collection="listRole" item="id" index="index" open="(" close=")" separator=",">
	 		 #{id}
		</foreach>
		</if>
	</select>
	<select id="queryEquipment" resultType="java.lang.String">
		SELECT
			serial_number
		FROM
			role_equipment
		WHERE
			project_id = #{projectId}
			<if test="listRole != null and listRole.size()>0">
				AND
				role_id in
				<foreach collection="listRole" item="id" index="index" open="(" close=")" separator=",">
					#{id}
				</foreach>
			</if>
	</select>
    <select id="findOneIdByBuildingIds" resultType="java.lang.Integer">
		SELECT id FROM `role_building` WHERE building_id IN
		<foreach collection="ids" item="id" index="index" open="(" close=")" separator=",">
			#{id}
		</foreach>
		LIMIT 1
	</select>
</mapper>