<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.meiot.dao.RoleEquipmentMapper">
	<insert id="insertRoleEquipment">
		INSERT INTO role_equipment (role_id,project_id, serial_number) SELECT
			#{roleId},
			#{projectId},
			equipment.serial_number
		FROM
			equipment
		WHERE
			equipment.building_id IN 
		<foreach collection="listBuilding" item="id" index="index" open="(" close=")" separator=",">
	 		 #{id}
		</foreach>
	</insert>
	
	<select id="queryBySerialAndRoleId" resultType="Long">
		SELECT
			role_id
		FROM
			role_equipment
		WHERE
			role_equipment.serial_number = #{serialNumber}
		AND
			role_equipment.role_id IN
		<foreach collection="listRole" item="id" index="index" open="(" close=")" separator=",">
	 		 #{id}
		</foreach>
		LIMIT 1
	</select>
	
	<delete id="deleteRoleId">
		DELETE FROM role_equipment WHERE  role_id = #{roleId}
		<if test="projectId != null">
			AND
				project_id =#{projectId}
		</if>
	</delete>
	
	<delete id="deleteSerialnumber">
		DELETE FROM role_equipment WHERE  serial_number = #{serialnumber}
	</delete>
	
	
	<select id="querySerialByRoleId" resultType="String">
		SELECT serial_number FROM role_equipment WHERE role_id = #{roleId}
	</select>
	
	<select id="queryRoleIdBySerial" resultType="Integer">
		SELECT role_equipment.role_id FROM role_equipment WHERE serial_number = #{serialNumber}
	</select>
	
	<insert id="insertBuildingEquipment">
		INSERT INTO role_equipment (role_id, serial_number,project_id) SELECT
			role_building.role_id,
			#{serialNumber},
			#{projectId}
		FROM
			role_building
		WHERE
			building_id = #{buildingId}
	</insert>
</mapper>