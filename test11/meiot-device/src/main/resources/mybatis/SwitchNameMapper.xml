<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.meiot.dao.SwitchNameMapper">
	
	<update id="updateSwitchSn">
		UPDATE switch_name SET switch_sn = #{newSn} WHERE switch_sn = #{oldSn}
	</update>
	
	<delete id="deleteSwitchName">
		DELETE switch_name  
		FROM
			switch
		JOIN switch_name
		ON
			switch.switch_sn = switch_name.switch_sn
		WHERE
			 switch.serial_number = #{serialNumber}
		<if test= "userId != null ">
		AND
			switch_name.user_id = #{userId}
		</if>
	</delete>
	<select id="querySwitchAll" resultType="java.util.Map">
		SELECT
			switch.switch_sn AS switchSn,
			IFNULL(switch_name.`name`,'') AS switchName,
			IFNULL(switch_type.`name`,'') AS switchType,
			IFNULL(switch_type.id,'') AS typeId
		FROM
			equipment_user
		JOIN
			switch
		ON
			equipment_user.serial_number = switch.serial_number
		LEFT JOIN
			switch_name
		ON
			switch.switch_sn = switch_name.switch_sn
		LEFT JOIN
			switch_type
		ON
			switch_name.switch_type = switch_type.id
		WHERE
			equipment_user.user_id = #{userId}
		AND
			equipment_user.serial_number = #{serialNumber}
	</select>
</mapper>