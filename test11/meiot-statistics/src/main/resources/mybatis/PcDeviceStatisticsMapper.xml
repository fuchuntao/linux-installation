<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.meiot.mapper.PcDeviceStatisticsMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.meiot.entity.PcDeviceStatistics">
        <id column="id" property="id" />
        <result column="year" property="year" />
        <result column="month" property="month" />
        <result column="device_total" property="deviceTotal" />
        <result column="type" property="type" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, year, month, device_total, type
    </sql>

    <resultMap type="cn.meiot.entity.vo.AppMeterHoursVo" id="BaseResultMapDev">
        <result column="serialNumber" javaType="STRING" property="serialNumber"/>
        <result column="projectId" javaType="INTEGER" property="projectId"/>
        <collection property="switchSnList" ofType="cn.meiot.entity.vo.DeviceVo">
            <result column="oldSwitchSn" javaType="LONG" property="oldSwitchSn" />
        </collection>
    </resultMap>


    <select id="selectDeviceStatistics" resultMap="BaseResultMapDev">
        SELECT
          equipment_user.serial_number AS serialNumber, switch.switch_sn AS oldSwitchSn , equipment_user.project_id AS projectId
        FROM equipment_user
        JOIN
	      switch
        ON
	      switch.serial_number = equipment_user.serial_number
        GROUP BY
	      equipment_user.serial_number, switch.switch_sn
    </select>

    <select id="selectListTime" resultType="java.lang.Integer">
        SELECT
        DISTINCT s_time
        FROM
        ${platform}_${tableName}_${timeName}
        WHERE
        project_id = #{projectId}
        <if test="serialNumber != null ">
            AND
            serial_number = #{serialNumber}
        </if>

        <if test="switchSn != null ">
            AND
            switch_sn = #{switchSn}
        </if>
        <if test ="sYear != null ">
            AND
            s_year = #{sYear}
        </if>
        <if test ="sMonth != null ">
            AND
            s_month = #{sMonth}
        </if>
        <if test ="sDay != null ">
            AND
            s_day = #{sDay}
        </if>
        <if test ="sTime != null ">
            AND
            s_time <![CDATA[<= #{sTime}]]>
        </if>

    </select>

</mapper>
